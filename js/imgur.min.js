chrome.runtime.sendMessage({method:"getItem",key:"comment-img"},(function(response){if("on"===response.data){console.log("Comment-img:ON");const cB=$("p");setInterval((function(){$(".jscroll-inner").ready((function(){comment2imgur(),comment2gyazo()}))}),1e3);var imgur=/(http:|https:)\/\/i\.imgur\.com\/.{5,7}\.(JPG|JPEG|PNG|GIF|BMP)/gi;function comment2imgur(){imgur&&$("p:contains(imgur)").each((function(index){var tt=$(this).text();if(!$(this).hasClass("has-imgur")){$(this).addClass("has-imgur"),console.log("#imgur-"+index+":"+tt);let width=$(this).parent().width();$(this).text((function(){var imgur=$(this).text().match(/(http:|https:)\/\/i\.imgur\.com\/.{5,7}\.(JPG|JPEG|PNG|GIF|BMP)/gi).toString();const imgurInner=imgur.replace(imgur,"<a href='"+imgur+"' target='_blank'><img src='"+imgur+"' title='"+imgur+"' style='display:block;max-width:"+width+"px'></a>");$(this).append(imgurInner)}))}}))}imgur=cB.text().match(imgur);var gyazo=/(http:|https:)\/\/i\.gyazo\.com\/.{1,64}\.(JPG|JPEG|PNG|GIF|BMP)/gi,clientId;function comment2gyazo(){gyazo&&$("p:contains(gyazo)").each((function(index){var tt2=$(this).text();if(!$(this).hasClass("has-gyazo")){$(this).addClass("has-gyazo"),console.log("#gyazo-"+index+":"+tt2);let width=$(this).parent().width();$(this).text((function(){var gyazo=tt2.match(/(http:|https:)\/\/i\.gyazo\.com\/.{1,64}\.(JPG|JPEG|PNG|GIF|BMP)/gi).toString();const gyazoInner=gyazo.replace(gyazo,"<a href='"+gyazo+"' target='_blank'><img src='"+gyazo+"' title='"+gyazo+"' style='display:block;max-width:"+width+"px'></a>");$(this).append(gyazoInner)}))}}))}gyazo=cB.text().match(gyazo);var upload='<p class="help">本日の残投稿可能数:<span id="rate-limit"></span>枚<br>サポートされている拡張子:JPG,JPEG,PNG,GIF,BMP</p><div uk-form-custom="target: true" class="mb10"><input type="file" id="upload-img" accept=".jpg,.jpeg,.png,.gif,.bmp"><input class="uk-input uk-form-width-medium" type="text" placeholder="Select file" disabled><label for="upload-img"><button class="uk-button uk-button-primary r05 error-message"><i class="fas fa-upload"></i>ファイルを選択</button></label></div><br>';function separate(num){return String(num).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")}$(".put_comment").parent().prepend(upload),$.get("https://api.dafu.cf/nemlog/count.txt",(function(data){var limit=1251-data;$("#rate-limit").text(separate(limit)),limit<=0&&($("#rate-limit").css("color","red"),$("#file-name").text("制限に達しました。"),$(".error-message").text("投稿不可"))})),$("#upload-img").change((function(){$.ajax({url:"https://api.dafu.cf/nemlog/count.php",type:"GET",dataType:"text",cache:!1}).done(response=>{const count=response,calc=count%2;console.log("count:"+count+" calc:"+calc),0===calc?clientId="Client-ID 822495165852723":1===calc&&(clientId="Client-ID 96cc9613384df75")}).fail(()=>{clientId="Client-ID 822495165852723",console.log("Failed...")}).always(()=>{if(console.log("Imgur ClientId:"+clientId),this.files.length>0){const file=this.files[0],filename=file.name;$("#file-name").text(filename);var reader=new FileReader;reader.readAsDataURL(file),reader.onload=function(){const imgdata=reader.result.split(",")[1];$.ajax({url:"https://api.imgur.com/3/image",headers:{Authorization:clientId},type:"POST",data:{image:imgdata}}).done((response,status,xhr)=>{console.log(status),limit=xhr.getResponseHeader("x-post-rate-limit-remaining");const link=response.data.link,value=$("#comment").val();$("#comment").val(value+link+"\n"),$("#rate-limit").text(separate(limit)),$("#upload-img").val(""),$("#file-name").text("")})}}})}))}else console.log("Comment-img:OFF")}));